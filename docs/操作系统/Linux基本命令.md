## 常用命令
### 文件与目录管理

#### 目录管理

- ls（list files）: 列出目录及文件名
- cd（change directory）：切换目录
- pwd（print work directory）：显示目前的目录
- mkdir（make directory）：创建一个新的目录
- rmdir（remove directory）：删除一个空的目录
- cp（copy file）: 复制文件或目录
- rm（remove）: 删除文件或目录
- mv（move file）: 移动文件与目录，或修改文件与目录的名称

#### 文件内容查看

- cat 由第一行开始显示文件内容
- tac 从最后一行开始显示，可以看出 tac 是 cat 的倒着写！
- nl 显示的时候，顺道输出行号！
- more 一页一页的显示文件内容
- less 与 more 类似，但是比 more 更好的是可以往前翻页
- head 只看头几行
- tail 只看尾巴几行
- wc:计算文件的Byte数、字数、或是列数;若不指定文件名称、或是所给予的文件名为"-"，则wc指令会从标准输入设备读取数据。


* **grep**:用于查找文件里符合条件的字符串.如果发现某文件的内容符合所指定的范本样式，预设 grep 指令会把含有范本样式的那一列显示出来。若不指定任何文件名称，或是所给予的文件名为 -，则 grep 指令会从标准输入设备读取数据。






#### 文件查找

> find 用于在指定目录下查找文件，如果使用该命令时，不设置任何参数，则 find 命令将在当前目录下查找子目录与文件。并且将查找到的子目录和文件全部进行显示。

**常用参数**

- -name name, -iname name : 文件名称符合 name 的文件。iname 会忽略大小写
- -size n : 文件大小 是 n 单位，b 代表 512 位元组的区块，c 表示字元数，k 表示 kilo bytes，w 是二个位元组。
- -type c : 文件类型是 c 的文件。
- -amin n : 在过去 n 分钟内被读取过
- -anewer file : 比文件 file 更晚被读取过的文件
- -atime n : 在过去 n 天内被读取过的文件
- -cmin n : 在过去 n 分钟内被修改过

#### 文件处理

> awk 是一种处理文本文件的语言，是一个强大的文本分析工具。
> awk [选项参数] 'script' var=value file(s)
或
> awk [选项参数] -f scriptfile var=value file(s)

**参数说明**

* -F fs ：指定输入文件折分隔符，fs是一个字符串或者是一个正则表达式，如-F:。
* -f scripfile：从脚本文件中读取awk命令。

>$number,表示记录的字段。比如，\$1 表示第 1 个字段，\$2 表示第 2 个字段，如此类推。而\$0 比较特殊，表示整个当前行
>NF,表示当前记录中的字段数量
>FS,表示字段分隔符
示例：

log.txt文本内容如下：

```
2 this is a test
3 Are you like awk
This's a test
10 There are orange,apple,mongo
```
每行按空格或TAB分割，输出文本中的1、4项

>awk '{print \$1,\$4}' log.txt

每行按","分割，输出文本中的1、2项

>awk -F, '{print \$1,\$2}'   log.txt
## 常见问题

### 文件相关



#### 使用 Linux 命令找出日志文件中访问量最大的 top10 IP 地址

日志文件 test.log 格式如下：

```
时间  IP
```

```
cat  test.log|awk -F" " '{print \$2}'|sort|uniq -c|sort -nrk 1 -t' '|awk -F" " '{print \$2}'|head -10
```

**解释**

1. cat \*.log 将文本内容打印到屏幕

2. 使用 awk 命令可以按照分割符将一行分割为多个列，第一列用$1 表示，第二列用$2 表示，依次类推

   `awk -F" " '{print $2} `//表示用空格作为分隔符进行分割，打印出第 2 列

3. sort 进行排序，默认是按照 ascii 码进行排序的

4. uniq -c 统计相邻的行的重复数量，结果是类似 3 127.13.13.13,前面的数字代码重复的行数

sort|uniq -c //统计重复的行数

5. sort -n 是按照数值进行由小到大进行排序， -r 是表示逆序，-t 是指定分割符，-k 是执行按照第几列进行排序

sort -nrk 1 -t' '

6. 使用 awk 命令可以按照分割符将一行分割为多个列，第一列用`$1` 表示，第二列用`$2 `表示，依次类推

`awk -F" " '{print $2}'` //表示用空格作为分隔符进行分割，打印出第 2 列

7. head -n 表示取前 n 个

### 性能相关

#### 查看整机系统性能

> top 命令查看

![](https://community-header-1306990603.cos.ap-guangzhou.myqcloud.com/20220227093735.png)

- 第一行是任务队列信息(系统运行状态及平均负载)，与 uptime 命令结果相同

  - load average 代表平均负载
  - up 部分的字段信息代表了当前系统的运行时间，即未重启时间，时间越长系统越稳定

- 第二行是 tasks 任务进程相关信息

  - 包括了进程总数、正在运行的进程数、睡眠进程数、停止进程数和僵尸进程数(zombie)

- 第三行是 CPU 相关信息，如果是多核 CPU，按数字 1 可显示各核 CPU 信息，此时 1 行将转为 Cpu 核数行，数字 1 可以来回切换

  - us 用户空间占用 CPU 百分比，例如：Cpu(s): 12.7%us
  - sy 内核空间占用 CPU 百分比，例如：8.4%sy
  - ...

- 第四行是内存相关信息

- 第五行是 Swap 交换分区相关信息

#### 查看 CPU 性能

> vmstat

![](https://community-header-1306990603.cos.ap-guangzhou.myqcloud.com/20220227094402.png)

一般 vmstat 工具的使用是通过两个数字参数来完成的，第一个参数是采样的时间间隔数（单位秒），第二个参数是采样的次数

**列参数含义**

- procs
  - r：运行和等待的 CPU 时间片的进程数
  - b：等待资源的进程数，比如正在等待磁盘 I/O、网络 I/O 等

#### 查看内存使用情况

> free

- 应用程序可用内存数：free -m (以 MB 为单位，查看物理内存)

- 以人类能看懂的方式查看物理内存:free -h

#### 查看硬盘使用情况

> df 查看磁盘分区的使用情况，了解磁盘总量及用量，默认单位为 KB

> du 查看文件和目录磁盘使用的空间

#### 查看占用 cpu/内存最多进程

> ps aux|sort -rn -k +3|head

ps aux 能够输出所有的进程,sort -rn -k +3 ，按照第三列数据进行排序，-r 是降序排序，-n 是按数值进行排序，-k 用来指定列,head -1 获取排序后的第一行数据

> 内存为+4

#### 找到 Java 进程中哪个线程占用了大量 CPU 处理时间

> top -H -p [PID]

- -H 是否开启线程模式，默认是 off

- -p 只显示某个进程的信息

crtl+p 进行 cpu 排序，找到线程 ID

接下来将该 java 进程的堆栈信息输出到一个文件

> jstack [PID] > jstack.txt

然后在该文件中找到对应的线程 ID。

### 网络相关

#### 查看网络 IO

> ifstat

#### 显示网络统计信息和端口占用情况

> netstat -anp | grep 进程号 （查看该进程网络信息）

> netstat -nlp | grep 端口号 （查看网络端口号占用情况）

**参数说明**

- -a：显示所有套接字，包括监听的和未监听的
- -t：选出 TCP 套接字（-u 选出 UDP）
- -l:处于 listen 状态的连接
- -p：显示连接归属的进程信息，查看端口被哪个进程占用
- -n：禁止使用端口的别名替代数字，比如说 ssh 代替 22 端口

#### 判断某个 ip 的端口是否可以访问、

> telnet ip port
