## 用户态和内核态

根据进程访问资源的特点，可以把进程在系统上的运行分为两个级别：

* 用户态(user mode) : 用户态运行的进程可以直接读取用户程序的数据。
* 内核态(kernel mode):可以简单的理解内核态运行的进程或程序几乎可以访问计算机的任何资源，不受限制。

凡是与系统态级别的资源有关的操作（如文件管理、进程控制、内存管理等)，都必须通过系统调用方式向操作系统提出服务请求，并由操作系统代为完成。


这些系统调用按功能大致可分为如下几类：

* 设备管理。完成设备的请求或释放，以及设备启动等功能。
* 文件管理。完成文件的读、写、创建及删除等功能。
* 进程控制。完成进程的创建、撤销、阻塞及唤醒等功能。
* 进程通信。完成进程之间的消息传递或信号传递等功能。
* 内存管理。完成内存的分配、回收以及获取作业占用内存区大小及地址等功能。


## 陷入内核态的方式

1. **系统调用(trap)**

用户态进程主动要求切换到内核态的一种方式,用户态进程通过系统调用申请使用操作系统提供的服务程序完成工作，比如 read 操作.而系统调用的机制其核心还是使用了操作系统为用户特别开放的一个中断来实现，例如Linux的int 80h中断。


2. **中断(interrupt)**

中断由处理器外部的硬件产生，不是执行某条指令的结果，也无法预测发生时机。由于中断独立于当前执行的程序，因此中断是异步事件。

中断包括 I/O 设备发出的 I/O 中断、各种定时器引起的时钟中断、调试程序中设置的断点等引起的调试中断等。

3. **异常(exception)**

异常是一种错误情况，是执行当前指令的结果，可能被错误处理程序修正，也可能直接终止应用程序。异常是同步的。

当发生异常时，操作系统会将控制转移给相应的异常处理程序。如果处理程序能够修正这个错误情况，就将**返回到引起异常的指令**重新执行。否则，终止该应用程序。

常见的异常
1. 除法错误:当应用程序试图除以零，或者一个除法指令结果溢出的时候，就会发生除法错误。Linux 会直接终止程序。
2. 一般保护故障：当程序访问一个未定义的虚拟内存区域(如访问空指针)，或者试图写一个只读的文本段，Linux 会直接终止程序。
3. 缺页异常:当应用程序访问未加载的页面时，会引起缺页异常。缺页处理程序会加载适当的页面，然后重新执行引起异常的指令


这3种方式是系统在运行时由用户态转到内核态的最主要方式，其中系统调用可以认为是用户进程主动发起的，异常和外围设备中断则是被动的。