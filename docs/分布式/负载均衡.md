## 概念
>**负载均衡（Load Balancing）**  
>调度后方的多台机器，以统一的接口对外提供服务，承担此职责的技术组件被称为“负载均衡”。
## 四层负载均衡和七层负载均衡
* 四层负载均衡工作在OSI模型的**传输层**，主要工作是**转发**，它在接收到客户端的流量以后通过修改数据包的地址信息将流量转发到应用服务器。主要**通过报文中的目标地址和端口**，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。

* 七层负载均衡工作在OSI模型的**应用层**，因为它需要解析应用层流量，所以七层负载均衡在接到客户端的流量以后，还需要一个完整的TCP/IP协议栈。主要**通过报文中的真正有意义的应用层内容**，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。

**区别**

* 四层:客户端与服务端建立连接，负载均衡设备起到转发作用
* 七层:负载均衡和客户端建立连接
## 负载均衡实现
DNS > 数据链路层 > IP层 > Http层

1. DNS
2. 
## 负载均衡算法

1. **随机算法**


Random 随机，可按权重设置随机概率。

在一个截面上碰撞的概率高，但调用量越大分布越均匀，而且按概率使用权重后也比较均匀，有利于动态调整提供者权重。  



2. **轮询及加权轮询**
   
轮询(Round Robbin)当服务器群中各服务器的处理能力相同时，且每笔业务处理量差异不大时，最适合使用这种算法。

轮循，按公约后的权重设置轮循比率。存在慢的提供者累积请求问题，比如：第二台机器很慢，但没挂，当请求调到第二台时就卡在那，久而久之，所有请求都卡在调到第二台上。

加权轮询(Weighted Round Robbin)为轮询中的每台服务器附加一定权重的算法。

比如服务器1权重1，服务器2权重2，服务器3权重3，则顺序为1-2-2-3-3-3-1-2-2-3-3-3- ……


3. **最小连接及加权最小连接**

（1）**最少连接(Least Connections)** 在多个服务器中，与处理连接数(会话数)最少的服务器进行通信的算法。即使在每台服务器处理能力各不相同，每笔业务处理量也不相同的情况下，也能够在一定程度上降低服务器的负载。

（2）**加权最少连接(Weighted Least Connection)** 为最少连接算法中的每台服务器附加权重的算法，该算法事先为每台服务器分配处理连接的数量，并将客户端请求转至连接数最少的服务器上。

根据系统的负载去处理。

4. **哈希算法**

* 普通哈希

* 一致性哈希

相同参数的请求总是发到同一提供者，当某一台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，不会引起剧烈变动。

[一致性哈希原理](https://kefeng.wang/2018/08/10/consistent-hashing/)

5. **IP地址散列**

通过管理发送方IP和目的地IP
地址的散列，将来自同一发送方的分组(或发送至同一目的地的分组)统一转发到相同服务器的算法。

当客户端有一系列业务需要处理而必须和一个服务器反复通信时，该算法能够以流(会话)为单位，保证来自相同客户端的通信能够一直在同一服务器中进行处理。

6. **URL散列**

通过管理客户端请求URL信息的散列，将发送至相同URL的请求转发至同一服务器的算法。