## CAP定理
* Consistency（一致性）
* Availability（可用性）
* Partition Tolerance（分区容错性）

![](https://img1.baidu.com/it/u=1480441474,719090499&fm=26&fmt=auto)

1. **一致性**

分布式环境中，⼀致性是指多个副本之间能否保持⼀致的特性。在⼀致性
的需求下，当⼀个系统在数据⼀致的状态下执⾏更新操作后，应该保证系
统的数据仍然处理⼀致的状态。

数据一致性又分为强一致性，弱一致性，最终一致性

* 强一致性：同一时间所有数据一致
* 最终一致性：一段时间后所有数据一致
* 弱一致性：部分数据不一致

2. **可用性**
   
系统提供的服务必须一直处于可用的状态，对于用户的每⼀个操作请求总
是能够在**有限的时间**内返回**正常的结果**。

3. 分区容错性

分布式系统在遇到任何⽹络分区故障时，仍然需要能够保证对外提供满
⾜⼀致性和可⽤性的服务，除⾮是整个⽹络环境都发⽣了故障。

>网络分区：分布式系统中，不同的节点分布在不同的⼦⽹络（机房/异
地⽹络）中，由于⼀些特殊的原因导致这些⼦⽹络之间出现⽹络不连通的
状态，但各个⼦⽹络的内部⽹络是正常的，从⽽导致整个系统的⽹络环境
被切分成了若⼲孤⽴的区域。组成⼀个分布式系统的每个节点的加⼊与退
出都可以看做是⼀个特殊的⽹络分区

### 一致性和可用性取舍

分布式系统必须满足分区容错性，当发生网络分区时，一致性和可用性只能选其一。

如果保证了⼀致性：对于节点N1和N2，当往N1⾥写数据时，
N2上的操作必须被暂停，只有当N1同步数据到N2时才能对N2进⾏读
写请求，在N2被暂停操作期间客户端提交的请求会收到失败或超时。
违背了可用性

如果保证了可⽤性：那就不能暂停N2的读写操作，但同时N1在
写数据的话，这就违背了⼀致性的要求。

因此，涉及金钱等资产的操作，必须保证一致性；对于用户实时交互量大，且数据一致性较为不重要，选择可用性。


## BASE定理

BASE是Basically Available（基本可⽤）、Soft state（软状态）和
Eventually consistent（最终⼀致性）三个短语的缩写。BASE基于CAP定
理演化⽽来，核⼼思想是**即时⽆法做到强⼀致性，但每个应⽤都可以根据
⾃身业务特点，采⽤适当的⽅式来使系统达到最终⼀致性。**

BASE理论其实就是对CAP理论的延伸和补充，主要是对AP的补充。牺牲
数据的强⼀致性，来保证数据的可⽤性，虽然存在中间装填，但数据最终
⼀致。

## Paxos算法

## Raft算法

## 一致性哈希

传统的哈希算法当需要变更集群数时，大部分数据需要进行迁移，重新映射，迁移成本高，而一致性哈希可以解决该问题。

不同于哈希算法对节点数量进行取模运算，一致性哈希算法对$2^{32}$进行取模，可以将哈希值空间看成一个虚拟的圆环.

假设有三个节点，将其哈希映射到圆环上的位置

![](https://community-header-1306990603.cos.ap-guangzhou.myqcloud.com/20220125133834.png)

当要进行数据的读写时，将其key计算哈希值，确定此key在环上的位置；然后从这个位置沿着哈希环顺时针行走，遇到的第一个节点就是key对应的节点。

![](https://community-header-1306990603.cos.ap-guangzhou.myqcloud.com/20220125134045.png)

当节点C被移除，key-03会被重定位到A；而在节点C之前增加一个节点D，key-03会被定位到节点D。

也就是说，一致性哈希算法在扩容或缩容时，只需要重定位环空间中的一小部分数据。

当节点太少，容易因为节点分布不均匀造成数据访问的冷热不均，也就是说大多数请求都会集中在少量几个节点上。

![](https://community-header-1306990603.cos.ap-guangzhou.myqcloud.com/20220125134625.png)

通过虚拟节点，也就是对每个服务器节点计算多个哈希值，将其虚拟节点映射到实际节点。以此解决冷热不均的问题。

![](https://community-header-1306990603.cos.ap-guangzhou.myqcloud.com/20220125134859.png)



## 分布式锁

## 分布式事务